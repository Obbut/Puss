<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Saving Strategy and Object Pooling  Reference</title>
    <link rel="stylesheet" type="text/css" href="css/jazzy.css" />
    <link rel="stylesheet" type="text/css" href="css/highlight.css" />
    <meta charset='utf-8'>
    <script src="js/jquery.min.js" defer></script>
    <script src="js/jazzy.js" defer></script>
    
  </head>
  <body>
    <a title="Saving Strategy and Object Pooling  Reference"></a>
    <header>
      <div class="content-wrapper">
        <p><a href="index.html">Meow Docs</a> (59% documented)</p>
        <p class="header-right"><a href="https://github.com/OpenKitten/Meow"><img src="img/gh.png"/>View on GitHub</a></p>
      </div>
    </header>
    <div class="content-wrapper">
      <p id="breadcrumbs">
        <a href="index.html">Meow Reference</a>
        <img id="carat" src="img/carat.png" />
        Saving Strategy and Object Pooling  Reference
      </p>
    </div>
    <div class="content-wrapper">
      <nav class="sidebar">
        <ul class="nav-groups">
          <li class="nav-group-name">
            <a href="Guides.html">Guides</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="getting-started.html">Getting Started</a>
              </li>
              <li class="nav-group-task">
                <a href="cli.html">CLI</a>
              </li>
              <li class="nav-group-task">
                <a href="plugins.html">Plugins</a>
              </li>
              <li class="nav-group-task">
                <a href="migrations.html">Migrations</a>
              </li>
              <li class="nav-group-task">
                <a href="data-format.html">Data Format</a>
              </li>
              <li class="nav-group-task">
                <a href="saving-strategy-and-object-pooling.html">Saving Strategy and Object Pooling</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Core Types.html">Core Types</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Protocols/BaseModel.html">BaseModel</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols/Model.html">Model</a>
              </li>
              <li class="nav-group-task">
                <a href="Enums/Meow.html">Meow</a>
              </li>
              <li class="nav-group-task">
                <a href="Enums/Meow/Helpers.html">– Helpers</a>
              </li>
              <li class="nav-group-task">
                <a href="Enums/Meow/Error.html">– Error</a>
              </li>
              <li class="nav-group-task">
                <a href="Enums/Meow/ObjectPool.html">– ObjectPool</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Other Classes.html">Other Classes</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Classes/Migrator.html">Migrator</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Other Enums.html">Other Enums</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Enums/IndexAttribute.html">IndexAttribute</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Other Extensions.html">Other Extensions</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Extensions/Binary.html">Binary</a>
              </li>
              <li class="nav-group-task">
                <a href="Extensions/Bool.html">Bool</a>
              </li>
              <li class="nav-group-task">
                <a href="Extensions/DBRef.html">DBRef</a>
              </li>
              <li class="nav-group-task">
                <a href="Extensions/Data.html">Data</a>
              </li>
              <li class="nav-group-task">
                <a href="Extensions/Date.html">Date</a>
              </li>
              <li class="nav-group-task">
                <a href="Extensions/Document.html">Document</a>
              </li>
              <li class="nav-group-task">
                <a href="Extensions/Double.html">Double</a>
              </li>
              <li class="nav-group-task">
                <a href="Extensions/GridFS.html">GridFS</a>
              </li>
              <li class="nav-group-task">
                <a href="Extensions/Int.html">Int</a>
              </li>
              <li class="nav-group-task">
                <a href="Extensions/Int32.html">Int32</a>
              </li>
              <li class="nav-group-task">
                <a href="Extensions/ObjectId.html">ObjectId</a>
              </li>
              <li class="nav-group-task">
                <a href="Extensions/RegularExpression.html">RegularExpression</a>
              </li>
              <li class="nav-group-task">
                <a href="Extensions/String.html">String</a>
              </li>
              <li class="nav-group-task">
                <a href="Extensions/ValueConvertible.html">ValueConvertible</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Other Functions.html">Other Functions</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Other Functions.html#/s:F4Meowop1nFV11MongoKitten5QueryS1_">!(_:)</a>
              </li>
              <li class="nav-group-task">
                <a href="Functions/&amp;=(_:_:).html">&amp;=(_:_:)</a>
              </li>
              <li class="nav-group-task">
                <a href="Functions/*(_:).html">*(_:)</a>
              </li>
              <li class="nav-group-task">
                <a href="Other Functions.html#/s:F4Meowoi2eeFTPS_15VirtualVariable_GSqP4BSON9Primitive___V11MongoKitten5Query">==(_:_:)</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Other Protocols.html">Other Protocols</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Protocols/KeyRepresentable.html">KeyRepresentable</a>
              </li>
              <li class="nav-group-task">
                <a href="Other Protocols.html#/s:P4Meow10MeowNumber">MeowNumber</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols/ModelKey.html">ModelKey</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols/ModelValues.html">ModelValues</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols/Serializable.html">Serializable</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols/SerializableToDocument.html">SerializableToDocument</a>
              </li>
              <li class="nav-group-task">
                <a href="Other Protocols.html#/s:P4Meow17VirtualComparable">VirtualComparable</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols/VirtualModelInstance.html">VirtualModelInstance</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols/VirtualVariable.html">VirtualVariable</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Other Structs.html">Other Structs</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Structs/File.html">File</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/Reference.html">Reference</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/VirtualArray.html">VirtualArray</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/VirtualBool.html">VirtualBool</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/VirtualData.html">VirtualData</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/VirtualDate.html">VirtualDate</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/VirtualDocument.html">VirtualDocument</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/VirtualEmbeddablesArray.html">VirtualEmbeddablesArray</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/VirtualNumber.html">VirtualNumber</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/VirtualObjectId.html">VirtualObjectId</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/VirtualString.html">VirtualString</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Other Typealiases.html">Other Typealiases</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Other Typealiases.html#/s:O4Meow4Meow15DatabaseProblem">DatabaseProblem</a>
              </li>
              <li class="nav-group-task">
                <a href="Other Typealiases.html#/s:E4MeowPS_5Model19PaginatedFindResult">PaginatedFindResult</a>
              </li>
            </ul>
          </li>
        </ul>
      </nav>
      <article class="main-content">
        <section>
          <section class="section">
            
            <h1 id='meow-object-pool-and-saving-strategy' class='heading'>Meow Object Pool and Saving Strategy</h1>

<p>Meow is designed to work primarily for server side applications that have a long lifespan. The object pooling mechanism and saving strategy is a result of this.</p>

<p>This document explains the general workings of the mechanism.</p>
<h2 id='the-pool' class='heading'>The pool</h2>

<p>Meow objects are automatically added to the object pool on creation, whenever possible. The object pool holds weak references to all alive objects and ensures no more than two instances with the same <code>ObjectId</code> can exist at the same time.</p>

<p>For every object, the object pool stores the instantiation date &amp; time, along with a lightweight hash. This hash is used for the autosave mechanism.</p>
<h2 id='saving' class='heading'>Saving</h2>

<p>Meow will save an object under the following circumstances:</p>

<ul>
<li>The contents of the object have changed since the last save, and the user calls <code>save()</code></li>
<li>The user calls <code>save(force: true)</code></li>
<li>The object is being deallocated and its contents have changed since the last save</li>
<li>The program exits and the contents of the object have changed since the last save</li>
<li>During maintenance, if object is older than the minimum object lifespan for autosaving (defaults to 5 seconds), and the contents of the object have changed since the last save</li>
</ul>

<p>The minimum lifespan for objects to be autosaved can be configured by setting <code>Meow.minimumAutosaveAge</code> to a custom value.</p>
<h2 id='the-maintenance-loop' class='heading'>The maintenance loop</h2>

<p>Meow has a background process, started by <code>Meow.init</code>, that handles some cleanup work as well as the autosaving of objects. By default, the autosave loop is scheduled 5 seconds after the previous loop iteration finished.</p>

<p>The maintenance interval can be configured by setting <code>Meow.maintenanceInterval</code> to a custom value.</p>
<h2 id='custom-code-init-code-catch' class='heading'>Custom <code>init</code> catch</h2>

<p>Meow cannot automatically pool instances of objects that are created within a custom <code>init</code>, because it has no way of knowing these objects are created. Under most circumstances, this is not a problem, because the <code>_id</code> of the new model is registered with the pool and the generated code ensures that <code>save()</code> is called when the object gets deallocated. </p>

<p>Hoever, ARC will not properly deallocate objects when the program is terminating. Because of this, if an object is created, but not deallocated, manually saved or manually pooled, and the instance still exists at the time the program quits, Meow is not able to save the data.</p>

<p>If you happen to have such objects, you can solve the problem by manually invoking <code>save()</code> on them, or pooling them by calling <code>Meow.pool.pool(myModel)</code>. You can do this in your custom initialiser.</p>

          </section>
        </section>
        <section id="footer">
          <p>Copyright © 2016 Robbert Brandsma &amp; Joannis Orlandos</p>
          <p>Generated by <a class="link" href="https://github.com/realm/jazzy" target="_blank" rel="external">jazzy ♪♫ v0.8.1</a>, a <a class="link" href="http://realm.io" target="_blank" rel="external">Realm</a> project.</p>
        </section>
      </article>
    </div>
  </body>
</div>
</html>
